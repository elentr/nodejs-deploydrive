openapi: 3.1.0

info:
  version: "1.0.0"
  title: Travellers API
  description: >
    API для платформи мандрівників: автентифікація, користувачі з власними
    статтями та можливістю зберігати улюблені історії.
    Є стрічка історій з пагінацією, фільтрацією за категоріями, а також
    завантаження фото на Cloudinary.
    Усі приватні ендпоінти вимагають Bearer access token.

servers:
  - url: "https://travellers-node.onrender.com"

security:
  - bearerAuth: []

tags:
  - name: Auth
    description: Авторизація та керування сесіями
  - name: Users
    description: Користувачі та особисті дані
  - name: Stories
    description: Історії мандрівок
  - name: Categories
    description: Категорії історій

paths:

  /api/auth/register:
    post:
      tags: [Auth]
      summary: Реєстрація нового користувача
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
            example:
              name: "Аліса"
              email: "alice@example.com"
              password: "secret12345"
      responses:
        "201":
          description: Користувача успішно зареєстровано

  /api/auth/login:
    post:
      tags: [Auth]
      summary: Вхід користувача
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                password:
                  type: string
            example:
              email: "alice@example.com"
              password: "secret12345"
      responses:
        "200":
          description: Успішний вхід

  /api/auth/refresh:
    post:
      tags: [Auth]
      summary: Оновлення access токена
      security: []
      responses:
        "200":
          description: Новий accessToken видано

  /api/auth/logout:
    post:
      tags: [Auth]
      summary: Вихід користувача
      responses:
        "204":
          description: Користувача успішно розлогінено

  /api/users:
    get:
      tags: [Users]
      summary: Отримати список користувачів
      security: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: perPage
          schema:
            type: integer
      responses:
        "200":
          description: Список користувачів

  /api/users/{userId}:
    get:
      tags: [Users]
      summary: Отримати дані користувача за ID
      security: []
      parameters:
        - in: path
          name: userId
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: perPage
          schema: { type: integer }
      responses:
        "200":
          description: Дані користувача

  /api/users/me/profile:
    get:
      tags: [Users]
      summary: Отримати профіль поточного користувача
      responses:
        "200":
          description: Профіль отримано

  /api/users/me:
    patch:
      tags: [Users]
      summary: Оновити дані поточного користувача
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type:
                    - string
                    - "null"
            example:
              name: "Аліса"
              description: "Люблю подорожі"
      responses:
        "200":
          description: Дані оновлено

  /api/users/me/avatar:
    patch:
      tags: [Users]
      summary: Оновити аватар користувача
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [avatar]
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        "200":
          description: Аватар оновлено

  /api/users/me/saved/{travellerId}:
    post:
      tags: [Users]
      summary: Додати історію до збережених
      parameters:
        - in: path
          name: travellerId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Історію додано
    delete:
      tags: [Users]
      summary: Видалити історію зі збережених
      parameters:
        - in: path
          name: travellerId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Історію видалено

  /api/stories:
    get:
      tags: [Stories]
      summary: Отримати історії
      security: []
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: perPage
          schema: { type: integer }
        - in: query
          name: category
          schema: { type: string }
      responses:
        "200":
          description: Список історій

    post:
      tags: [Stories]
      summary: Створити нову історію
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [title, article, category, img]
              properties:
                title: { type: string }
                article: { type: string }
                category: { type: string }
                img:
                  type: string
                  format: binary
      responses:
        "201":
          description: Створено

  /api/stories/{storiesId}:
    patch:
      tags: [Stories]
      summary: Оновити історію
      parameters:
        - in: path
          name: storiesId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title: { type: string }
                article: { type: string }
                category: { type: string }
                img:
                  type: string
                  format: binary
      responses:
        "200":
          description: Оновлено

  /api/categories:
    get:
      tags: [Categories]
      summary: Отримати список категорій
      security: []
      responses:
        "200":
          description: Категорії знайдено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: integer }
                  message: { type: string }
                  data:
                    type: array
                    items: { type: string }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
