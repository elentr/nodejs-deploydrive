openapi: 3.1.0

info:
  version: '1.0.0'
  title: Travellers API
  description: >
    API для платформи мандрівників: автентифікація, користувачі з власними
    статтями та можливістю зберігати улюблені історії. Є стрічка історій з
    пагінацією, фільтрацією за категоріями, а також завантаження фото на
    Cloudinary. Усі приватні ендпоінти вимагають Bearer access token.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: 'https://travellers-node.onrender.com'

security:
  - bearerAuth: []

tags:
  - name: Auth
    description: Авторизація та керування сесіями
  - name: Users
    description: Користувачі та особисті дані
  - name: Stories
    description: Історії мандрівок
  - name: Categories
    description: Категорії історій

paths:
  /api/auth/register:
    post:
      operationId: registerUser
      tags: [Auth]
      summary: Реєстрація нового користувача
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
            example:
              name: 'Аліса'
              email: 'alice@example.com'
              password: 'secret12345'
      responses:
        '201':
          description: Користувача успішно зареєстровано

  /api/auth/login:
    post:
      operationId: loginUser
      tags: [Auth]
      summary: Вхід користувача
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                password:
                  type: string
            example:
              email: 'alice@example.com'
              password: 'secret12345'
      responses:
        '200':
          description: Успішний вхід

  /api/auth/refresh:
    post:
      operationId: refreshAccessToken
      tags: [Auth]
      summary: Оновлення access токена
      security: []
      responses:
        '200':
          description: Новий accessToken видано

  /api/auth/logout:
    post:
      operationId: logoutUser
      tags: [Auth]
      summary: Вихід користувача
      responses:
        '204':
          description: Користувача успішно розлогінено

  /api/users:
    get:
      operationId: getUsers
      tags: [Users]
      summary: Отримати список користувачів
      security: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: perPage
          schema:
            type: integer
      responses:
        '200':
          description: Список користувачів

  /api/users/{userId}:
    get:
      operationId: getUserById
      tags: [Users]
      summary: Отримати дані користувача за ID
      security: []
      parameters:
        - in: path
          name: userId
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: perPage
          schema: { type: integer }
      responses:
        '200':
          description: Дані користувача

  /api/users/me/profile:
    get:
      operationId: getMyProfile
      tags: [Users]
      summary: Отримати профіль поточного користувача
      responses:
        '200':
          description: Профіль отримано

  /api/users/me:
    patch:
      operationId: updateMyProfile
      tags: [Users]
      summary: Оновити дані поточного користувача
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type:
                    - string
                    - 'null'
            example:
              name: 'Аліса'
              description: 'Люблю подорожі'
      responses:
        '200':
          description: Дані оновлено

  /api/users/me/avatar:
    patch:
      operationId: updateMyAvatar
      tags: [Users]
      summary: Оновити аватар користувача
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [avatar]
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: Аватар оновлено

  /api/users/me/saved/{travellerId}:
    post:
      operationId: addStoryToSaved
      tags: [Users]
      summary: Додати історію до збережених
      parameters:
        - in: path
          name: travellerId
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Історію додано
    delete:
      operationId: removeStoryFromSaved
      tags: [Users]
      summary: Видалити історію зі збережених
      parameters:
        - in: path
          name: travellerId
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Історію видалено

  /api/stories:
    get:
      operationId: getStories
      tags: [Stories]
      summary: Отримати історії
      security: []
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: perPage
          schema: { type: integer }
        - in: query
          name: category
          schema: { type: string }
      responses:
        '200':
          description: Список історій

    post:
      operationId: createStory
      tags: [Stories]
      summary: Створити нову історію
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [title, article, category, img]
              properties:
                title: { type: string }
                article: { type: string }
                category: { type: string }
                img:
                  type: string
                  format: binary
      responses:
        '201':
          description: Створено

  /api/stories/{storiesId}:
    patch:
      operationId: updateStory
      tags: [Stories]
      summary: Оновити історію
      parameters:
        - in: path
          name: storiesId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title: { type: string }
                article: { type: string }
                category: { type: string }
                img:
                  type: string
                  format: binary
      responses:
        '200':
          description: Оновлено

  /api/stories/popular:
    get:
      operationId: getPopularStories
      tags: [Stories]
      summary: Отримати популярні історії
      security: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, example: 1 }
        - in: query
          name: perPage
          schema: { type: integer, example: 3 }
      responses:
        '200':
          description: Популярні історії успішно знайдено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: 'Successfully found popular stories!'
                  data:
                    type: object
                    properties:
                      stories:
                        type: array
                        description: Список популярних історій
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: '68498236a100312bea079004'
                            img:
                              type: string
                              example: 'https://ftp.goit.study/img/travel-blog/68498236a100312bea079004.webp'
                            title:
                              type: string
                              example: 'Сицилія: вулкани, міста i смаки'
                            article:
                              type: string
                              example: |
                                Сицилія — це поєднання історії, природи i
                                кулінарії...
                            category:
                              type: string
                              example: '68fb50c80ae91338641121f2'
                            ownerId:
                              type: string
                              example: '6881563901add19ee16fcffb'
                            date:
                              type: string
                              example: '2025-03-08'
                            favoriteCount:
                              type: integer
                              example: 29
                      total:
                        type: integer
                        example: 94
                      page:
                        type: integer
                        example: 1
                      perPage:
                        type: integer
                        example: 3
                      hasNextPage:
                        type: boolean
                        example: true

  /api/categories:
    get:
      operationId: getCategories
      tags: [Categories]
      summary: Отримати список категорій
      security: []
      responses:
        '200':
          description: Категорії знайдено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: integer }
                  message: { type: string }
                  data:
                    type: array
                    items: { type: string }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
